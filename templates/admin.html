{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto mt-10 mb-20">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-white">üéõÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <a href="/" class="text-slate-400 hover:text-white">‚Üê –ù–∞ —Å–∞–π—Ç</a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- –ö–û–õ–û–ù–ö–ê 1: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
        <div>
            <h2 class="text-xl font-bold text-white mb-4">üìÇ –¢–µ–º—ã –∏ –§—Ä–∞–∑—ã</h2>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–∞–∑—ã (—Å–≤–µ—Ä–Ω—É—Ç–∞—è –∏–ª–∏ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è) -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6">
                <p class="text-slate-400 text-sm mb-4">–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:</p>
                <form action="/admin/add_phrase" method="post" class="space-y-3">
                    <select name="topic_id" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                        {% for topic in topics %}
                        <option value="{{ topic.id }}">[{{ topic.level_slug }}] {{ topic.title_ru }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="text_ru" required placeholder="–§—Ä–∞–∑–∞ RU" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <input type="text" name="text_en" required placeholder="Phrase EN" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <input type="text" name="text_uz" required placeholder="Ibora UZ" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <input type="hidden" name="order_index" value="1">
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–º —Å —É–¥–∞–ª–µ–Ω–∏–µ–º -->
            <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                <table class="w-full text-left text-sm text-slate-400">
                    <thead class="bg-slate-900 text-slate-200">
                        <tr>
                            <th class="p-3">LVL</th>
                            <th class="p-3">–¢–µ–º–∞</th>
                            <th class="p-3 text-right">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700">
                        {% for topic in topics %}
                        <tr class="hover:bg-slate-700/50">
                            <td class="p-3 font-bold text-blue-400">{{ topic.level_slug }}</td>
                            <td class="p-3 text-white">
                                <a href="/admin/topic/{{ topic.id }}" class="hover:underline hover:text-blue-400">
                                    {{ topic.title_ru }} ({{ topic.count }})
                                </a>
                            </td>
                            <td class="p-3 text-right flex justify-end gap-2">
                                <a href="/admin/topic/{{ topic.id }}" class="bg-blue-600 text-white px-2 py-1 rounded text-xs">Edit</a>
                                <form action="/admin/delete_topic" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–µ–º—É –∏ –í–°–ï —Ñ—Ä–∞–∑—ã –≤–Ω—É—Ç—Ä–∏?');">
                                    <input type="hidden" name="topic_id" value="{{ topic.id }}">
                                    <button class="bg-red-600 text-white px-2 py-1 rounded text-xs">Del</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ö–û–õ–û–ù–ö–ê 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
        <div>
            <h2 class="text-xl font-bold text-white mb-4">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                <table class="w-full text-left text-sm text-slate-400">
                    <thead class="bg-slate-900 text-slate-200">
                        <tr>
                            <th class="p-3">Email</th>
                            <th class="p-3">–†–æ–ª—å</th>
                            <th class="p-3 text-right">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700">
                        {% for user in users %}
                        <tr class="hover:bg-slate-700/50">
                            <td class="p-3 text-white truncate max-w-[150px]" title="{{ user.email }}">{{ user.email }}</td>
                            <td class="p-3">
                                {% if user.is_admin %}
                                <span class="bg-purple-600 text-white text-xs px-2 py-0.5 rounded">Admin</span>
                                {% else %}
                                <span class="bg-slate-600 text-white text-xs px-2 py-0.5 rounded">User</span>
                                {% endif %}
                            </td>
                            <td class="p-3 text-right flex justify-end gap-2">
                                <!-- –ö–Ω–æ–ø–∫–∞ –ê–¥–º–∏–Ω/–Æ–∑–µ—Ä -->
                                <form action="/admin/toggle_admin" method="post">
                                    <input type="hidden" name="user_id" value="{{ user.id }}">
                                    <input type="hidden" name="is_admin" value="{{ 'True' if user.is_admin else 'False' }}">
                                    <button class="text-xs border border-slate-500 px-2 py-1 rounded hover:bg-slate-700 transition">
                                    {{ '‚¨áÔ∏è –°–Ω—è—Ç—å' if user.is_admin else '‚¨ÜÔ∏è –ù–∞–∑–Ω–∞—á–∏—Ç—å' }}
                                </form>
                                <!-- –ö–Ω–æ–ø–∫–∞ –£–¥–∞–ª–∏—Ç—å -->
                                <form action="/admin/delete_user" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?');">
                                    <input type="hidden" name="user_id" value="{{ user.id }}">
                                    <button class="bg-red-900 text-red-200 px-2 py-1 rounded text-xs hover:bg-red-800">X</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ Excel -->
        <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 shadow-lg mb-10">
            <h2 class="text-xl font-bold text-green-400 mb-4">üìó –ò–º–ø–æ—Ä—Ç –∏–∑ Excel</h2>
            
            <form action="/admin/import_excel" method="post" enctype="multipart/form-data" class="space-y-4">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                    <!-- –í—ã–±–æ—Ä —Ç–µ–º—ã -->
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">–ö—É–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å?</label>
                        <select name="topic_id" class="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white focus:border-green-500 outline-none">
                            {% for topic in topics %}
                            <option value="{{ topic.id }}">
                                [{{ topic.level_slug }}] {{ topic.title_ru }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">–§–∞–π–ª (.xlsx)</label>
                        <input type="file" name="file" accept=".xlsx, .xls" required
                            class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-600 file:text-white hover:file:bg-green-500">
                    </div>
                </div>

                <div class="bg-slate-900/50 p-4 rounded text-sm text-slate-400">
                    <p class="font-bold mb-1">‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–∞–π–ª—É Excel:</p>
                    <p>–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏:</p>
                    <code class="bg-slate-700 px-1 rounded text-white">text_ru</code>, 
                    <code class="bg-slate-700 px-1 rounded text-white">text_en</code>, 
                    <code class="bg-slate-700 px-1 rounded text-white">text_uz</code>
                    <span class="ml-2">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: order_index)</span>
                </div>

                <button type="submit" class="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition">
                    üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ—Ä–∞–∑—ã
                </button>
            </form>
        </div>

    </div>
</div>
{% endblock %}